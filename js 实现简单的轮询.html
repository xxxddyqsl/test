<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>js 实现简单的轮询</title>
</head>

<body>
    <button onclick="setTimer()">js 实现简单的轮询</button>
    <button onclick="startTimer()">开始 js 计算 两个时间戳 之间的 时长</button>
    <button onclick="endTimer()">结束 js 计算 两个时间戳 之间的 时长</button>
</body>
<script type="text/JavaScript">
       let a = 0; var b = 9;
let i=0;
// var aa = function  () {
//    return {

//    }
// }
// if(i>=3){
//         alert("1111");
//     }else{
//         setTimeout(() => {
//             i+=1;
//             console.log(i)
//             aa();
//         }, 100);
      
//     }
    var self = setTimeout(() => {
    if(i>=3){
        alert("1111");
    }else{
        i+=1;
        console.log(i);
        self;
    }
}, 100);
// }
//心跳检测
// var heartCheck = {
//     timeout: 540000,        //9分钟发一次心跳
//     timeoutObj: null,
//     serverTimeoutObj: null,
//     reset: function(){
//         clearTimeout(this.timeoutObj);
//         clearTimeout(this.serverTimeoutObj);
//         return this;
//     },
//     start: function(){
//         var self = this;
//         this.timeoutObj = setTimeout(function(){
//             //这里发送一个心跳，后端收到后，返回一个心跳消息，
//             //onmessage拿到返回的心跳就说明连接正常 
//             console.log("ping!")
//             self.serverTimeoutObj = setTimeout(function(){//如果超过一定时间还没重置，说明后端主动断开了
//                 ws.close();     //如果onclose会执行reconnect，我们执行ws.close()就行了.如果直接执行reconnect 会触发onclose导致重连两次
//             }, self.timeout)
//         }, this.timeout)
//     }
// }
    //当前时间与2018-05-10的时间差
var startTime = "2022-02-13 16:40"; 
    //    var startTime = new Date();
       let calculateTimer; 
       function startTimer() {
        calculateTimer =  setInterval(() => {
            getRemainderTime ()
            },1000) 
    }; 
function  endTimer() {
    
    clearTimeout(calculateTimer) //清理定时任务
}
// 计算 两个时间戳 之间的 时长
function getRemainderTime (){
    var s1 = new Date(startTime.replace(/-/g, "/"));
    // var s1=startTime;
    var  s2 = new Date(),
    runTime = parseInt((s2.getTime() - s1.getTime()) / 1000);
    // var year = Math.floor(runTime / 86400 / 365);
    // runTime = runTime % (86400 * 365);
    // var month = Math.floor(runTime / 86400 / 30);
    // runTime = runTime % (86400 * 30);
    // var day = Math.floor(runTime / 86400);
    // runTime = runTime % 86400;
    // 时
    var hour = Math.floor(runTime / 3600);
    runTime = runTime % 3600;
    // 分
    var minute = Math.floor(runTime / 60);
    runTime = runTime % 60;
    // 秒
    var second = runTime;
    if(hour<10){
        hour= '0' + hour;
    }
    if(minute<10){
        minute= '0' + minute;
    }
    if(second<10){
        second= '0' + second;
    }
   
    console.log(hour+':'+minute+':'+second);
//    console.log(year,month,day,hour,minute,second);
// 　　return year+','+month+','+day+','+hour+','+minute+','+second;
 
}


// 实现简单的轮询
    function setTimer() {
        let timer; 
       if (a < b) {a+=1;
            console.log(a);
            timer = setInterval(() => {
                this.setTimer()
            })
        } else {
            clearTimeout(timer) //清理定时任务
        }

    }; 
    // set_time('1632732049')
    // uinx时间戳
    let time=parseInt(new Date().getTime()/1000);
    //  第2种parseInt(new Date().getTime()) 
    set_time(time);
    // 如何js比较两个时间戳是否相差5分钟
    // Math.abs(1632732013  - 1632732017) >= (5 * 60 * 1000)
    // uinx时间戳 比较两个时间戳
    //  Math.abs(time1 - time2) >= (5 * 60 )
function set_time(str){
    // 获取时间戳
    // parseInt(new Date().getTime()/1000)
    // 看在获取时间戳的时候有没有 /1000 如： 第一种parseInt(new Date().getTime()/1000)   第2种parseInt(new Date().getTime()) 
    //如果是uinx时间戳记得乘于1000
//   var n = parseInt(str)*1000;
  var n = parseInt(str);
  var D = new Date(n);
  var year = D.getFullYear();//四位数年份

  var month = D.getMonth()+1;//月份(0-11),0为一月份
  month = month<10?('0'+month):month;

  var day = D.getDate();//月的某一天(1-31)
  day = day<10?('0'+day):day;

  var hours = D.getHours();//小时(0-23)
  hours = hours<10?('0'+hours):hours;

  var minutes = D.getMinutes();//分钟(0-59)
  minutes = minutes<10?('0'+minutes):minutes;

  // var seconds = D.getSeconds();//秒(0-59)
  // seconds = seconds<10?('0'+seconds):seconds;
  // var week = D.getDay();//周几(0-6),0为周日
  // var weekArr = ['周日','周一','周二','周三','周四','周五','周六'];

  var now_time = year+'-'+month+'-'+day+' '+hours+':'+minutes;
  return now_time;
};
    </script>

</html>