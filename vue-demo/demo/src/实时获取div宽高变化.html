<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- 开发环境版本，包含了有帮助的命令行警告 -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <style>
        .container {
            position: relative;
        }

        .resize-element {
            /* transform: translate(-50%, -50%); */
            position: relative;
            /* top: 50%; */
            /* left: 50%; */
            /* ; */
            /* height:  10rem; */
            width: 10rem;
            overflow: hidden;
            /* resize:  both; */
            display: block;
            box-shadow: 0 0 1px 1px #3361D8;
            border-radius: 2px;
        }
       
    </style>
</head>

<body>
    <div id="app">
        <div class="container">
            <div class="resize-element">
                改变大小试试
            </div>
            <div class="resize-record" @click='add()'>
                触发了{{firedNum}}次resize事件。
            </div>

        </div>

    </div>


</body>
<script>

    var vm = new Vue({
        el: '#app',
        data: {

            observer: null,
            nullaa: 0,
            firedNum: 0,
            recordOldValue: { // 记录下旧的宽高数据，避免重复触发回调函数
                width: '0',
                height: '0'
            }
        },
        mounted() {
            this.GetWidthAndHeight();
        },
        beforeDestroyed() {
            if (this.observer) {
                this.observer.disconnect()
                this.observer.takeRecords()
                this.observer = null
            }
        },
        methods: {
            add() {
                this.nullaa += 1
                var node = document.createElement("DIV");
                node.style.height = 20;
                node.innerHTML = this.nullaa;
                document.querySelector('.resize-element').appendChild(node);
                // var aa=document.querySelector('.resize-element').clientHeight;
                // document.querySelector('.resize-element').style.minheight = aa+'px';
                console.log(document.querySelector('.resize-element'));
            },
            GetWidthAndHeight() {
                console.log(this.recordOldValue);
                let MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver
                let element = document.querySelector('.resize-element')
                this.observer = new MutationObserver((mutationList) => {
                    for (let mutation of mutationList) {
                        console.log(mutation)
                    }
                    console.log(this.recordOldValue);
                    let width = getComputedStyle(element).getPropertyValue('width');
                    let height = getComputedStyle(element).getPropertyValue('height');
                    console.log('width:' + width, 'height：' + height);
                    // 宽 高是否和之前一样
                    if (width === this.recordOldValue.width && height === this.recordOldValue.height) return
                    this.recordOldValue = {
                        width,
                        height
                    }

                    this.firedNum += 1
                })
                this.observer.observe(element, { attributes: true, attributeFilter: ['style'], attributeOldValue: true })
            }
        }
    });

</script>

</html>